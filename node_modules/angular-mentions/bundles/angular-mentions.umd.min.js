!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("angular-mentions",["exports","@angular/core","@angular/common"],t):t((e=e||self)["angular-mentions"]={},e.ng.core,e.ng.common)}(this,(function(e,t,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function n(e,t,i,n){var o,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,i,s):o(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s}function o(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}Object.create;Object.create;function r(e){return a(e)?e.value:e.textContent}function s(e,t,i,n,o,c){if(void 0===c&&(c=!1),function(e){return null!=e&&("INPUT"==e.nodeName||"TEXTAREA"==e.nodeName||"#text"==e.nodeName)}(e)){var h=r(e);!function(e,t){a(e)?e.value=t:e.textContent=t}(e,h.substring(0,t)+n+h.substring(i,h.length)),l(e,t+n.length,o)}else if(!c){var p=d(o);if(p&&p.rangeCount>0){var f=p.getRangeAt(0).startOffset;s(p.anchorNode,f-(i-t),f,n,o,!0)}}}function a(e){return null!=e&&("INPUT"==e.nodeName||"TEXTAREA"==e.nodeName)}function l(e,t,i){if(void 0===i&&(i=null),a(e)&&e.selectionStart)e.focus(),e.setSelectionRange(t,t);else{var n=h(i).createRange();n.setStart(e,t),n.collapse(!0);var o=d(i);o.removeAllRanges(),o.addRange(n)}}function c(e,t){if(void 0===t&&(t=null),a(e))return e.value.slice(0,e.selectionStart).length;var i=d(t);if(i.rangeCount>0){var n=i.getRangeAt(0),o=n.cloneRange();return o.selectNodeContents(e),o.setEnd(n.endContainer,n.endOffset),o.toString().length}}function h(e){return e?e.contentWindow.document:document}function d(e){return e?e.contentWindow.getSelection():window.getSelection()}function p(e){var t="sel_"+(new Date).getTime()+"_"+Math.random().toString().substr(2),i=h(e?e.iframe:null),n=d(e?e.iframe:null),o=n.getRangeAt(0),r=i.createRange();r.setStart(n.anchorNode,o.startOffset),r.setEnd(n.anchorNode,o.startOffset),r.collapse(!1);var s=i.createElement("span");s.id=t,s.appendChild(i.createTextNode("\ufeff")),r.insertNode(s),n.removeAllRanges(),n.addRange(o);var a={left:0,top:s.offsetHeight};return function(e,t,i){var n=t,o=e?e.iframe:null;for(;n&&(null==e.parent||e.parent!=n);)i.left+=n.offsetLeft+n.clientLeft,i.top+=n.offsetTop+n.clientTop,!(n=n.offsetParent)&&o&&(n=o,o=null);n=t,o=e?e.iframe:null;for(;n!==h(null).body&&null!=n&&(null==e.parent||e.parent!=n);)n.scrollTop&&n.scrollTop>0&&(i.top-=n.scrollTop),n.scrollLeft&&n.scrollLeft>0&&(i.left-=n.scrollLeft),!(n=n.parentNode)&&o&&(n=o,o=null)}(e,s,a),s.parentNode.removeChild(s),a}var f=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],m="undefined"!=typeof window,u=m&&null!=window.mozInnerScreenX;var g=function(){function e(e){this.element=e,this.labelKey="label",this.itemClick=new t.EventEmitter,this.items=[],this.activeIndex=0,this.hidden=!1,this.dropUp=!1,this.styleOff=!1,this.coords={top:0,left:0},this.offset=0}return e.prototype.ngAfterContentChecked=function(){this.itemTemplate||(this.itemTemplate=this.defaultItemTemplate)},e.prototype.position=function(e,t){if(void 0===t&&(t=null),a(e))this.coords=function(e,t,i){if(!m)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var n=i&&i.debug||!1;if(n){var o=document.querySelector("#input-textarea-caret-position-mirror-div");o&&o.parentNode.removeChild(o)}var r=document.createElement("div");r.id="input-textarea-caret-position-mirror-div",document.body.appendChild(r);var s=r.style,a=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,l="INPUT"===e.nodeName;s.whiteSpace="pre-wrap",l||(s.wordWrap="break-word"),s.position="absolute",n||(s.visibility="hidden"),f.forEach((function(e){if(l&&"lineHeight"===e)if("border-box"===a.boxSizing){var t=parseInt(a.height),i=parseInt(a.paddingTop)+parseInt(a.paddingBottom)+parseInt(a.borderTopWidth)+parseInt(a.borderBottomWidth),n=i+parseInt(a.lineHeight);s.lineHeight=t>n?t-i+"px":t===n?a.lineHeight:"0"}else s.lineHeight=a.height;else s[e]=a[e]})),u?e.scrollHeight>parseInt(a.height)&&(s.overflowY="scroll"):s.overflow="hidden",r.textContent=e.value.substring(0,t),l&&(r.textContent=r.textContent.replace(/\s/g," "));var c=document.createElement("span");c.textContent=e.value.substring(t)||".",r.appendChild(c);var h={top:c.offsetTop+parseInt(a.borderTopWidth),left:c.offsetLeft+parseInt(a.borderLeftWidth),height:parseInt(a.lineHeight)};return n?c.style.backgroundColor="#aaa":document.body.removeChild(r),h}(e,e.selectionStart,null),this.coords.top=e.offsetTop+this.coords.top-e.scrollTop,this.coords.left=e.offsetLeft+this.coords.left-e.scrollLeft,this.offset=this.getBlockCursorDimensions(e).height;else if(t){var i={iframe:t,parent:t.offsetParent};this.coords=p(i)}else{var n=document.documentElement,o=(window.pageXOffset||n.scrollLeft)-(n.clientLeft||0),r=(window.pageYOffset||n.scrollTop)-(n.clientTop||0),s=p({iframe:t}),l=e.getBoundingClientRect();this.coords.top=s.top-l.top+e.offsetTop-r,this.coords.left=s.left-l.left+e.offsetLeft-o}this.positionElement()},Object.defineProperty(e.prototype,"activeItem",{get:function(){return this.items[this.activeIndex]},enumerable:!0,configurable:!0}),e.prototype.activateNextItem=function(){var e=this.list.nativeElement,t=e.getElementsByClassName("active").item(0);if(t){var i=t.nextSibling;if(i&&"LI"==i.nodeName){var n=i.getBoundingClientRect();n.bottom>e.getBoundingClientRect().bottom&&(e.scrollTop=i.offsetTop+n.height-e.clientHeight)}}this.activeIndex=Math.max(Math.min(this.activeIndex+1,this.items.length-1),0)},e.prototype.activatePreviousItem=function(){var e=this.list.nativeElement,t=e.getElementsByClassName("active").item(0);if(t){var i=t.previousSibling;if(i&&"LI"==i.nodeName)i.getBoundingClientRect().top<e.getBoundingClientRect().top&&(e.scrollTop=i.offsetTop)}this.activeIndex=Math.max(Math.min(this.activeIndex-1,this.items.length-1),0)},e.prototype.reset=function(){this.list.nativeElement.scrollTop=0,this.checkBounds()},e.prototype.checkBounds=function(){var e=this.coords.left,t=this.coords.top,i=this.dropUp,n=this.list.nativeElement.getBoundingClientRect();n.left+n.width>window.innerWidth&&(e-=n.left+n.width-window.innerWidth+10),n.top<0&&(i=!1),this.positionElement(e,t,i)},e.prototype.positionElement=function(e,t,i){void 0===e&&(e=this.coords.left),void 0===t&&(t=this.coords.top),void 0===i&&(i=this.dropUp);var n=this.element.nativeElement;t+=i?0:this.offset,n.className=i?"dropup":null,n.style.position="absolute",n.style.left=e+"px",n.style.top=t+"px"},e.prototype.getBlockCursorDimensions=function(e){var t=window.getComputedStyle(e);return{height:parseFloat(t.lineHeight),width:parseFloat(t.fontSize)}},e.ctorParameters=function(){return[{type:t.ElementRef}]},n([t.Input(),o("design:type",String)],e.prototype,"labelKey",void 0),n([t.Input(),o("design:type",t.TemplateRef)],e.prototype,"itemTemplate",void 0),n([t.Output(),o("design:type",Object)],e.prototype,"itemClick",void 0),n([t.ViewChild("list",{static:!0}),o("design:type",t.ElementRef)],e.prototype,"list",void 0),n([t.ViewChild("defaultItemTemplate",{static:!0}),o("design:type",t.TemplateRef)],e.prototype,"defaultItemTemplate",void 0),e=n([t.Component({selector:"mention-list",template:'\n    <ng-template #defaultItemTemplate let-item="item">\n      {{item[labelKey]}}\n    </ng-template>\n    <ul #list [hidden]="hidden" class="dropdown-menu scrollable-menu"\n      [class.mention-menu]="!styleOff" [class.mention-dropdown]="!styleOff && dropUp">\n      <li *ngFor="let item of items; let i = index"\n        [class.active]="activeIndex==i" [class.mention-active]="!styleOff && activeIndex==i">\n        <a class="dropdown-item" [class.mention-item]="!styleOff"\n          (mousedown)="activeIndex=i;itemClick.emit();$event.preventDefault()">\n          <ng-template [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{\'item\':item}"></ng-template>\n        </a>\n      </li>\n    </ul>\n    ',styles:[".mention-menu{position:absolute;top:100%;left:0;z-index:1000;display:none;float:left;min-width:11em;padding:.5em 0;margin:.125em 0 0;font-size:1em;color:#212529;text-align:left;list-style:none;background-color:#fff;background-clip:padding-box;border:1px solid rgba(0,0,0,.15);border-radius:.25em}.mention-item{display:block;padding:.2em 1.5em;line-height:1.5em;clear:both;font-weight:400;color:#212529;text-align:inherit;white-space:nowrap;background-color:transparent;border:0}.mention-active>a{color:#fff;text-decoration:none;background-color:#337ab7;outline:0}.scrollable-menu{display:block;height:auto;max-height:292px;overflow:auto}[hidden]{display:none}.mention-dropdown{bottom:100%;top:auto;margin-bottom:2px}"]}),o("design:paramtypes",[t.ElementRef])],e)}(),v=function(){function e(e,i,n){var o=this;this._element=e,this._componentResolver=i,this._viewContainerRef=n,this.mentionConfig={items:[]},this.DEFAULT_CONFIG={items:[],triggerChar:"@",labelKey:"label",maxItems:-1,allowSpace:!1,returnTrigger:!1,mentionSelect:function(e,t){return o.activeConfig.triggerChar+e[o.activeConfig.labelKey]}},this.searchTerm=new t.EventEmitter,this.itemSelected=new t.EventEmitter,this.opened=new t.EventEmitter,this.closed=new t.EventEmitter,this.triggerChars={}}return Object.defineProperty(e.prototype,"mention",{set:function(e){this.mentionItems=e},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){(e.mention||e.mentionConfig)&&this.updateConfig()},e.prototype.updateConfig=function(){var e=this,t=this.mentionConfig;this.triggerChars={},this.mentionItems&&(t.items=this.mentionItems),this.addConfig(t),t.mentions&&t.mentions.forEach((function(t){return e.addConfig(t)}))},e.prototype.addConfig=function(e){var t=Object.assign({},this.DEFAULT_CONFIG),i=(e=Object.assign(t,e)).items;i&&i.length>0&&("string"==typeof i[0]&&(i=i.map((function(t){var i={};return i[e.labelKey]=t,i}))),e.labelKey&&(i=i.filter((function(t){return t[e.labelKey]})),e.disableSort||i.sort((function(t,i){return t[e.labelKey].localeCompare(i[e.labelKey])})))),e.items=i,this.triggerChars[e.triggerChar]=e,this.activeConfig&&this.activeConfig.triggerChar==e.triggerChar&&(this.activeConfig=e,this.updateSearchList())},e.prototype.setIframe=function(e){this.iframe=e},e.prototype.stopEvent=function(e){e.wasClick||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())},e.prototype.blurHandler=function(e){this.stopEvent(e),this.stopSearch()},e.prototype.inputHandler=function(e,t){if(void 0===t&&(t=this._element.nativeElement),229===this.lastKeyCode&&e.data){var i=e.data.charCodeAt(0);this.keyHandler({keyCode:i,inputEvent:!0},t)}},e.prototype.keyHandler=function(e,t){if(void 0===t&&(t=this._element.nativeElement),this.lastKeyCode=e.keyCode,!e.isComposing&&229!==e.keyCode){var i=r(t),n=c(t,this.iframe),o=e.key;if(!o){var a=e.which||e.keyCode;o=!e.shiftKey&&a>=65&&a<=90?String.fromCharCode(a+32):String.fromCharCode(e.which||e.keyCode)}13==e.keyCode&&e.wasClick&&n<this.startPos&&(n=this.startNode.length,l(this.startNode,n,this.iframe));var h=this.triggerChars[o];if(h)this.activeConfig=h,this.startPos=e.inputEvent?n-1:n,this.startNode=(this.iframe?this.iframe.contentWindow.getSelection():window.getSelection()).anchorNode,this.searching=!0,this.searchString=null,this.showSearchList(t),this.updateSearchList(),h.returnTrigger&&this.searchTerm.emit(h.triggerChar);else if(this.startPos>=0&&this.searching)if(n<=this.startPos)this.searchList.hidden=!0;else if(16!==e.keyCode&&!e.metaKey&&!e.altKey&&!e.ctrlKey&&n>this.startPos){if(this.activeConfig.allowSpace||32!==e.keyCode){if(8===e.keyCode&&n>0)--n==this.startPos&&this.stopSearch();else if(!this.searchList.hidden){if(9===e.keyCode||13===e.keyCode){this.stopEvent(e),this.itemSelected.emit(this.searchList.activeItem);var d=this.activeConfig.mentionSelect(this.searchList.activeItem,this.activeConfig.triggerChar);if(s(t,this.startPos,n,d,this.iframe),"createEvent"in document){var p=document.createEvent("HTMLEvents");this.iframe?p.initEvent("change",!0,!1):p.initEvent("input",!0,!1),this._element.nativeElement.dispatchEvent(p)}return this.startPos=-1,this.stopSearch(),!1}if(27===e.keyCode)return this.stopEvent(e),this.stopSearch(),!1;if(40===e.keyCode)return this.stopEvent(e),this.searchList.activateNextItem(),!1;if(38===e.keyCode)return this.stopEvent(e),this.searchList.activatePreviousItem(),!1}}else this.startPos=-1;if(1!=o.length&&8!=e.keyCode)return this.stopEvent(e),!1;if(this.searching){var f=i.substring(this.startPos+1,n);if(8===e.keyCode||e.inputEvent||(f+=o),this.searchString=f,this.activeConfig.returnTrigger){var m=this.searchString||8===e.keyCode?i.substring(this.startPos,this.startPos+1):"";this.searchTerm.emit(m+this.searchString)}else this.searchTerm.emit(this.searchString);this.updateSearchList()}}}},e.prototype.startSearch=function(e,t){void 0===t&&(t=this._element.nativeElement),e=e||this.mentionConfig.triggerChar||this.DEFAULT_CONFIG.triggerChar;var i=c(t,this.iframe);s(t,i,i,e,this.iframe),this.keyHandler({key:e,inputEvent:!0},t)},e.prototype.stopSearch=function(){this.searchList&&!this.searchList.hidden&&(this.searchList.hidden=!0,this.closed.emit()),this.activeConfig=null,this.searching=!1},e.prototype.updateSearchList=function(){var e=this,t=[];if(this.activeConfig&&this.activeConfig.items){var i=this.activeConfig.items;if(!this.activeConfig.disableSearch&&this.searchString&&this.activeConfig.labelKey){var n=this.searchString.toLowerCase();i=i.filter((function(t){return t[e.activeConfig.labelKey].toLowerCase().startsWith(n)}))}t=i,this.activeConfig.maxItems>0&&(t=t.slice(0,this.activeConfig.maxItems))}this.searchList&&(this.searchList.items=t,this.searchList.hidden=0==t.length)},e.prototype.showSearchList=function(e){var t=this;if(this.opened.emit(),null==this.searchList){var i=this._componentResolver.resolveComponentFactory(g),n=this._viewContainerRef.createComponent(i);this.searchList=n.instance,this.searchList.itemTemplate=this.mentionListTemplate,n.instance.itemClick.subscribe((function(){e.focus();var i={key:"Enter",keyCode:13,wasClick:!0};t.keyHandler(i,e)}))}this.searchList.labelKey=this.activeConfig.labelKey,this.searchList.dropUp=this.activeConfig.dropUp,this.searchList.styleOff=this.mentionConfig.disableStyle,this.searchList.activeIndex=0,this.searchList.position(e,this.iframe),window.setTimeout((function(){return t.searchList.reset()}))},e.ctorParameters=function(){return[{type:t.ElementRef},{type:t.ComponentFactoryResolver},{type:t.ViewContainerRef}]},n([t.Input("mention"),o("design:type",Array),o("design:paramtypes",[Array])],e.prototype,"mention",null),n([t.Input(),o("design:type",Object)],e.prototype,"mentionConfig",void 0),n([t.Input(),o("design:type",t.TemplateRef)],e.prototype,"mentionListTemplate",void 0),n([t.Output(),o("design:type",Object)],e.prototype,"searchTerm",void 0),n([t.Output(),o("design:type",Object)],e.prototype,"itemSelected",void 0),n([t.Output(),o("design:type",Object)],e.prototype,"opened",void 0),n([t.Output(),o("design:type",Object)],e.prototype,"closed",void 0),e=n([t.Directive({selector:"[mention], [mentionConfig]",host:{"(keydown)":"keyHandler($event)","(input)":"inputHandler($event)","(blur)":"blurHandler($event)",autocomplete:"off"}}),o("design:paramtypes",[t.ElementRef,t.ComponentFactoryResolver,t.ViewContainerRef])],e)}(),y=function(){function e(){}return e=n([t.NgModule({declarations:[v,g],imports:[i.CommonModule],exports:[v],entryComponents:[g]})],e)}();e.MentionDirective=v,e.MentionModule=y,e.ɵa=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-mentions.umd.min.js.map